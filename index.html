<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Inventaire Pause Burger</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --bg: #f6f6f6;
      --card: #ffffff;
      --accent: #ff7a00;
      --accent-dark: #e06600;
      --text: #111;
      --muted: #666;
      --border: #dddddd;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    header {
      position: sticky;
      top: 0;
      display: flex;
      align-items: center;
      gap: 10px;
      background: #111;
      padding: 10px 14px;
      color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      z-index: 20;
    }

    header img {
      height: 45px;
      width: auto;
      border-radius: 6px;
      object-fit: contain;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: .05em;
      text-transform: uppercase;
    }

    .subtitle {
      font-size: 12px;
      color: #cccccc;
    }

    main {
      padding: 12px;
      padding-bottom: 100px;
      max-width: 900px;
      margin: 0 auto;
    }

    .toolbar {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 14px;
      font-weight: 600;
      background: var(--accent);
      color: white;
    }

    .btn-secondary {
      background: #ffffff;
      border: 1px solid var(--border);
      color: var(--text);
    }

    .category {
      margin-bottom: 18px;
    }

    .category-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: .04em;
    }

    .item {
      background: var(--card);
      border-radius: 10px;
      padding: 10px;
      border: 1px solid var(--border);
      margin-bottom: 6px;
    }

    .item-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .item-name {
      font-size: 15px;
      font-weight: 600;
      flex: 1;
    }

    input[type=number] {
      width: 70px;
      padding: 6px;
      font-size: 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      text-align: center;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fafafa;
      font-size: 12px;
    }

    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      max-width: 900px;
      margin: 0 auto;
      padding: 12px;
      background: #111;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .footer .count {
      font-size: 14px;
    }

    .footer .hint {
      font-size: 11px;
      color: #cccccc;
    }

    .btn-white {
      border-radius: 999px;
      padding: 8px 12px;
      border: 1px solid white;
      background: transparent;
      color: white;
      font-size: 12px;
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      padding: 20px;
      z-index: 100;
    }

    .modal.open {
      display: flex;
    }

    .modal-box {
      background: white;
      border-radius: 10px;
      width: 100%;
      max-width: 520px;
      max-height: 80vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-body {
      padding: 12px;
      overflow-y: auto;
      font-size: 14px;
      white-space: pre-wrap;
    }

    .modal-footer {
      padding: 8px 12px 10px;
      border-top: 1px solid #ddd;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .modal-footer .btn {
      font-size: 12px;
      padding: 6px 10px;
    }
  </style>
</head>

<body>
<header>
  <!-- le logo doit s'appeler IMG_0100.jpeg dans le dépôt -->
  <img src="IMG_0100.jpeg" alt="Logo Pause Burger">
  <div class="title-block">
    <div class="title">Pause Burger</div>
    <div class="subtitle">Inventaire · Soir</div>
  </div>
</header>

<main>
  <div class="toolbar">
    <button class="btn" id="showList">Voir à commander</button>
    <button class="btn btn-secondary" id="resetBtn">Réinitialiser</button>
  </div>

  <div id="categories"></div>
</main>

<div class="footer">
  <div>
    <div class="count"><span id="count">0</span> articles à commander</div>
    <div class="hint">Coche “À commander” et mets la quantité.</div>
  </div>
  <button class="btn-white" id="shareBtn">Partager</button>
</div>

<div class="modal" id="modal">
  <div class="modal-box">
    <div class="modal-header">
      <b>Liste à commander</b>
      <button class="btn btn-secondary" id="closeModal">Fermer</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" id="copyBtn">Copier</button>
    </div>
  </div>
</div>

<script>
  // --- Données inventaire (liste finale validée) ---

  const DATA = {
    "Frites": [
      "Frites"
    ],

    "Crudités": [
      "Salade",
      "Tomate",
      "Oignon",
      "Cornichon"
    ],

    "Viandes": [
      "Steak 90g",
      "Steak 45g",
      "CB",
      "Kebab",
      "Nuggets",
      "Fricadelle",
      "Mexicain",
      "Poulet",
      "Fish",
      "Merguez",
      "Chorizo",
      "Lardons",
      "Rösti",
      "Wings",
      "Wings épicé"
    ],

    "Fromages / Suppléments": [
      "Cheddar",
      "Raclette",
      "Chèvre",
      "Oignons frits",
      "Mozzarella",
      "Boursin",
      "Bacon",
      "Œuf",
      "Miel"
    ],

    "Sauce cheddar / fromagère": [
      "Sauce cheddar",
      "Sauce fromagère"
    ],

    "Sauces (groupe 1)": [
      "Mayonnaise",
      "Biggy",
      "Giant",
      "Algérienne",
      "Ketchup",
      "Samouraï",
      "Barbecue"
    ],

    "Sauces (groupe 2 / autres)": [
      "Andalouse",
      "Poivre",
      "Pita",
      "Oignons poivrons",
      "Américain",
      "Tasty",
      "Smoky",
      "Curry",
      "Fish",
      "Cheezy",
      "Brazil",
      "Chili Thaï",
      "Mammouth",
      "Harissa"
    ],

    "Galettes": [
      "Galette tacos grande",
      "Galette tacos petite"
    ],

    "Emballages": [
      "Emballage wrap",
      "Emballage tacos",
      "Emballage grand burger",
      "Emballage petit burger",
      "Boîte tenders x3",
      "Boîte tenders x7",
      "Boîte tenders x14",
      "Boîte tenders x20"
    ],

    "Pains": [
      "Pain sésame",
      "Pain brioché",
      "Pain toast",
      "Petit pain",
      "Pain noir",
      "Pain peluche",
      "Pain rouge"
    ],

    "Épices": [
      "Farine",
      "Épices tenders",
      "Épice jaune",
      "Sel",
      "Poivre"
    ],

    "Papier / Consommable": [
      "Papier cuisson",
      "Aluminium",
      "Sac de congélation"
    ],

    "Huile": [
      "Huile"
    ],

    "Vinaigre": [
      "Vinaigre"
    ],

    "Produits ménagers": [
      "Essuie-tout",
      "Lave-sol",
      "Eau javel",
      "Dégraissant",
      "Serpillière",
      "Éponge inox",
      "Gants",
      "Sac poubelle",
      "Lave mains"
    ]
  };

  // --- Gestion de l'état / sauvegarde ---

  const STORAGE_KEY = "pb_inventory_v3";

  function slug(text) {
    return text
      .toLowerCase()
      .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
      .replace(/[^a-z0-9]+/g, "-");
  }

  function initialState() {
    const s = {};
    Object.entries(DATA).forEach(([cat, items]) => {
      items.forEach(name => {
        const id = slug(cat + "-" + name);
        s[id] = { qty: "", checked: false, order: false, name, cat };
      });
    });
    return s;
  }

  function loadState() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return initialState();
      const saved = JSON.parse(raw);
      const base = initialState();
      // merge pour garder nouveaux items
      Object.keys(base).forEach(id => {
        if (!saved[id]) saved[id] = base[id];
      });
      return saved;
    } catch (e) {
      return initialState();
    }
  }

  let state = loadState();

  function saveState() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  // --- Rendu ---

  const categoriesEl = document.getElementById("categories");
  const countEl = document.getElementById("count");
  const modal = document.getElementById("modal");
  const modalBody = document.getElementById("modalBody");

  function renderCategories() {
    categoriesEl.innerHTML = "";
    Object.entries(DATA).forEach(([cat, items]) => {
      const catDiv = document.createElement("div");
      catDiv.className = "category";
      const title = document.createElement("div");
      title.className = "category-title";
      title.textContent = cat;
      catDiv.appendChild(title);

      items.forEach(name => {
        const id = slug(cat + "-" + name);
        if (!state[id]) state[id] = { qty: "", checked: false, order: false, name, cat };
        const itemData = state[id];

        const itemDiv = document.createElement("div");
        itemDiv.className = "item";

        const row1 = document.createElement("div");
        row1.className = "item-row";

        const nameEl = document.createElement("div");
        nameEl.className = "item-name";
        nameEl.textContent = name;

        const qtyInput = document.createElement("input");
        qtyInput.type = "number";
        qtyInput.min = "0";
        qtyInput.placeholder = "Qté";
        qtyInput.value = itemData.qty || "";
        qtyInput.addEventListener("input", e => {
          state[id].qty = e.target.value;
          saveState();
          updateCount();
        });

        row1.appendChild(nameEl);
        row1.appendChild(qtyInput);

        const row2 = document.createElement("div");
        row2.className = "item-row";

        const chipSeen = document.createElement("label");
        chipSeen.className = "chip";
        const seenCheckbox = document.createElement("input");
        seenCheckbox.type = "checkbox";
        seenCheckbox.checked = itemData.checked;
        seenCheckbox.addEventListener("change", e => {
          state[id].checked = e.target.checked;
          saveState();
        });
        const seenText = document.createElement("span");
        seenText.textContent = "Vu";
        chipSeen.appendChild(seenCheckbox);
        chipSeen.appendChild(seenText);

        const chipOrder = document.createElement("label");
        chipOrder.className = "chip";
        const orderCheckbox = document.createElement("input");
        orderCheckbox.type = "checkbox";
        orderCheckbox.checked = itemData.order;
        orderCheckbox.addEventListener("change", e => {
          state[id].order = e.target.checked;
          saveState();
          updateCount();
        });
        const orderText = document.createElement("span");
        orderText.textContent = "À commander";
        chipOrder.appendChild(orderCheckbox);
        chipOrder.appendChild(orderText);

        row2.appendChild(chipSeen);
        row2.appendChild(chipOrder);

        itemDiv.appendChild(row1);
        itemDiv.appendChild(row2);
        catDiv.appendChild(itemDiv);
      });

      categoriesEl.appendChild(catDiv);
    });

    updateCount();
  }

  function updateCount() {
    const nb = Object.values(state).filter(i => i.order).length;
    countEl.textContent = nb.toString();
  }

  // --- Construction de la liste texte pour le patron ---

  function buildOrderList() {
    const selected = Object.values(state).filter(i => i.order);
    if (selected.length === 0) {
      return "Aucun article à commander.";
    }

    // grouper par catégorie
    const byCat = {};
    selected.forEach(item => {
      if (!byCat[item.cat]) byCat[item.cat] = [];
      byCat[item.cat].push(item);
    });

    let lines = [];
    lines.push("Liste à commander – Pause Burger");
    lines.push("");

    Object.entries(byCat).forEach(([cat, items]) => {
      lines.push("[" + cat + "]");
      items.forEach(it => {
        const q = it.qty && it.qty !== "" ? it.qty : "1";
        lines.push("- " + it.name + " x " + q);
      });
      lines.push("");
    });

    return lines.join("\n");
  }

  // --- Events ---

  document.getElementById("resetBtn").addEventListener("click", () => {
    if (!confirm("Tout réinitialiser (quantités + cases) ?")) return;
    state = initialState();
    saveState();
    renderCategories();
  });

  document.getElementById("showList").addEventListener("click", () => {
    const txt = buildOrderList();
    modalBody.textContent = txt;
    modal.classList.add("open");
  });

  document.getElementById("closeModal").addEventListener("click", () => {
    modal.classList.remove("open");
  });

  modal.addEventListener("click", e => {
    if (e.target === modal) {
      modal.classList.remove("open");
    }
  });

  document.getElementById("copyBtn").addEventListener("click", async () => {
    const txt = buildOrderList();
    try {
      await navigator.clipboard.writeText(txt);
      alert("Liste copiée dans le presse-papiers ✅");
    } catch (e) {
      alert("Impossible de copier automatiquement. Tu peux sélectionner le texte et le copier manuellement.");
    }
  });

  document.getElementById("shareBtn").addEventListener("click", async () => {
    const txt = buildOrderList();
    const title = "Liste à commander – Pause Burger";
    try {
      if (navigator.share) {
        await navigator.share({ title, text: txt });
      } else if (navigator.clipboard) {
        await navigator.clipboard.writeText(txt);
        alert("Liste copiée, tu peux la coller dans WhatsApp / SMS ✅");
      } else {
        alert(txt);
      }
    } catch (e) {
      // partage annulé, on ne fait rien
    }
  });

  // --- Init ---

  renderCategories();
</script>
</body>
</html>
